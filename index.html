<html>
  <head>
    <link rel="stylesheet" type="text/css" href="allstyles.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    />
    <meta charset="UTF-8" />
  </head>
  <body>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>

    <img
      id="rings"
      src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Olympic_rings_without_rims.svg/1200px-Olympic_rings_without_rims.svg.png"
    />
    <div id="title">The History of the Olympic Games (1896 - 2016)</div>

    <div id="subtitle">
      ðŸ‘‡Click on Olympic cities on the map to start exploring!ðŸ‘‡
    </div>

    <div class="row1">
      <div class="cityname">
        <u>Hello:)</u>
        <div class="calcontainer">
          <!-- <img
            id="cal"
            src="https://cdn2.iconfinder.com/data/icons/date-and-time-flat/64/Calendar_month_date_schedule_blank-512.png"
          /> -->
          <div class="center">
            <div class="box">
              <select class="dd"> </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row2">
      <div id="column1">
        <!-- <img id="map" src="https://images.fineartamerica.com/images/artworkimages/mediumlarge/2/world-map-outline-in-gray-color-chokkicx.jpg"> -->
        <div id="map"></div>
        <!-- for the bar chart -->
        <h1>Number of Athletes by Continent</h1>
        <p>This chart shows the number of atheletes from each continent.</p>
        <div id="my_dataviz"></div>
      </div>
      <!-- packed circles -->
      <div id="column2">
        <h1>Medals by Country</h1>
        <p>
          This chart shows the medals of every participating countries. You can
          drag multiple countries together to compare their sizes!
        </p>
        <svg id="bubbles"></svg>
        <!--table -->
        <h1>Top 10 Athletes</h1>
        <p>This table shows the top 10 athelets that get the most medals.</p>
        <div id="table"></div>
      </div>
    </div>

    <script>
      var width = 0.3 * window.innerWidth,
        height = 0.45 * window.innerHeight,
        sizeDivisor = 3,
        nodePadding = 2.5;

      var svg = d3
        .select("#bubbles")
        .attr("width", width)
        .attr("height", height);
      var tooltip = d3
        .select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

      var color = d3.scaleOrdinal([
        "#66c2a5",
        "#fc8d62",
        "#8da0cb",
        "#e78ac3",
        "#a6d854",
        "#ffd92f",
        "#e5c494",
        "#b3b3b3"
      ]);

      var simulation = d3
        .forceSimulation()
        .force(
          "forceX",
          d3
            .forceX()
            .strength(0.1)
            .x(width * 0.5)
        )
        .force(
          "forceY",
          d3
            .forceY()
            .strength(0.1)
            .y(height * 0.5)
        )
        .force(
          "center",
          d3
            .forceCenter()
            .x(width * 0.5)
            .y(height * 0.5)
        )
        .force("charge", d3.forceManyBody().strength(-15));

      d3.csv("data/nation_medal_count.csv", types, drawBub);
      function drawBub(error, graph) {
        if (error) throw error;

        //update the simulation based on the data
        simulation
          .nodes(graph)
          .force(
            "collide",
            d3
              .forceCollide()
              .strength(0.5)
              .radius(function(d) {
                return d.radius + nodePadding;
              })
              .iterations(1)
          )
          .on("tick", function(d) {
            node
              .attr("cx", function(d) {
                return d.x;
              })
              .attr("cy", function(d) {
                return d.y;
              });
          });

        var node = svg
          .append("g")
          .attr("class", "node")
          .selectAll("circle")
          .data(graph)
          .enter()
          .append("circle")
          .attr("r", function(d) {
            return d.radius;
          })
          .attr("fill", function(d) {
            return color(d.continent);
          })
          .attr("cx", function(d) {
            return d.x;
          })
          .attr("cy", function(d) {
            return d.y;
          })

          .on("mouseover", function(d) {
            tooltip.style("opacity", 0.9);
            selected = d3.select(this).data()[0];
            tooltip
              .html(selected.team + "<br>" + selected.medals + " medals")
              .style("left", d3.event.x + "px")
              .style("top", d3.event.y + "px");
          })
          // .on("mousemove", function(d) {
          //   tooltip
          //     .transition()
          //     .duration(100)
          //     .style("opacity", 0.9);
          //   selected = d3.select(this).data()[0];
          //   tooltip
          //     .html(selected.team + "<br>" + selected.medals + " medals")
          //     .style("left", d3.event.pageX + "px")
          //     .style("top", d3.event.pageY - 28 + "px");
          // })
          .on("mouseout", function(d) {
            tooltip.style("opacity", 0);
          });
        svg
          .select("g")
          .selectAll("circle")
          .call(
            d3
              .drag()
              .on("start", dragstarted)
              .on("drag", dragged)
              .on("end", dragended)
          );
      }

      function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.03).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
      }

      function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0.03);
        d.fx = null;
        d.fy = null;
      }

      function types(d) {
        d.medals = +d.medals;
        d.size = +d.medals / sizeDivisor;
        d.size < 3 ? (d.radius = 3) : (d.radius = d.size);
        return d;
      }

      // -------------------------------------------------TABLE-------------------------------------------------------------
      d3.csv("data/athlete_medal_count_1.csv", function(error, myData) {
        if (error) {
          console.log("Had an error loading file.");
        }
        // We'll be using simpler data as values, not objects.
        var myArray = [];
        myData.forEach(function(d, i) {
          // now we add another data object value, a calculated value.
          // here we are making strings into numbers using type coercion
          // d.rank = +d.rank;
          d.medals = +d.medals;
          // Add a new array with the values of each:
          myArray.push([d.name, d.sex, d.team, d.sport, d.medals]);
        });
        // console.log(myData);
        // console.log(myArray);
        //sort data by difference
        myArray.sort(function(a, b) {
          return b[4] - a[4];
        });
        // You could also have made the new array with a map function!
        //using colors and fonts from the UNICEF Style Guide
        var table = d3.select("#table").append("table");
        var header = table.append("thead").append("tr");
        header
          .selectAll("th")
          .data(["Name", "Sex", "Team", "Sport", "Medals"])
          .enter()
          .append("th")
          .text(function(d) {
            return d;
          });
        var tablebody = table.append("tbody");
        rows = tablebody
          .selectAll("tr")
          .data(myArray.slice(0, 10))
          .enter()
          .append("tr");
        // We built the rows using the nested array - now each row has its own array.
        cells = rows
          .selectAll("td")
          // each row has data associated; we get it and enter it for the cells.
          .data(function(d) {
            // console.log(d);
            return d;
          })
          .enter()
          .append("td")
          .text(function(d) {
            return d;
          });
      });
      // -------------------------------------------------BAR CHART-------------------------------------------------------------
      var margin = { top: 10, right: 10, bottom: 50, left: 40 },
        width3 = 0.65 * window.innerWidth - margin.left - margin.right,
        height3 = 0.35 * window.innerHeight - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg2 = d3
        .select("#my_dataviz")
        .append("svg")
        .attr("width", width3 + margin.left + margin.right)
        .attr("height", height3 + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Parse the Data
      d3.csv("data/attending_athletes.csv", function(data) {
        // X axis
        var x = d3
          .scaleBand()
          .range([0, width3])
          .domain(
            data.map(function(d) {
              return d.continent;
            })
          )
          .padding(0.2);
        svg2
          .append("g")
          .attr("transform", "translate(0," + height3 + ")")
          .call(d3.axisBottom(x))
          .selectAll("text")
          .attr("transform", "translate(-10,0)rotate(-45)")
          .style("text-anchor", "end");

        // Add Y axis
        var y = d3
          .scaleLinear()
          .domain([0, 5000])
          .range([height3, 0]);
        svg2.append("g").call(d3.axisLeft(y));

        // Bars
        svg2
          .selectAll("mybar")
          .data(
            data.filter(function(d) {
              return d.year == "2016";
            })
          )
          .enter()
          .append("rect")
          .attr("x", function(d) {
            return x(d.continent);
          })
          .attr("width", x.bandwidth())
          .attr("fill", "#69b3a2")
          // no bar at the beginning thus:
          .attr("height", function(d) {
            return height3 - y(0);
          }) // always equal to 0
          .attr("y", function(d) {
            return y(0);
          });

        // Animation
        svg2
          .selectAll("rect")
          .transition()
          .duration(800)
          .attr("y", function(d) {
            return y(d.num);
          })
          .attr("height", function(d) {
            return height3 - y(d.num);
          })
          .delay(function(d, i) {
            return i * 100;
          });
      });
    </script>
    <script src="//unpkg.com/topojson@3.0.2/dist/topojson.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
